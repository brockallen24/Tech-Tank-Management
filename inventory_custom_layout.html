<!DOCTYPE html>
<html lang="en">
  <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Inventory Management - Tech Tank</title>
      <style>
                * {
                              margin: 0;
                              padding: 0;
                              box-sizing: border-box;
                }

                body {
                              font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                              background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                              min-height: 100vh;
                              padding: 20px;
                }

                .container {
                              max-width: 1200px;
                              margin: 0 auto;
                              background: white;
                              border-radius: 15px;
                              box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
                              overflow: hidden;
                }

                header {
                              background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
                              color: white;
                              padding: 30px;
                              text-align: center;
                }

                header h1 {
                              font-size: 2.5em;
                              margin-bottom: 10px;
                }

                header p {
                              font-size: 1.1em;
                              opacity: 0.9;
                }

                .content {
                              padding: 40px;
                }

                .controls {
                              display: grid;
                              grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                              gap: 20px;
                              margin-bottom: 40px;
                }

                input, select, button {
                              padding: 12px 15px;
                              border: 2px solid #e0e0e0;
                              border-radius: 8px;
                              font-size: 1em;
                              font-family: inherit;
                }

                button {
                              background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
                              color: white;
                              border: none;
                              cursor: pointer;
                              transition: all 0.3s ease;
                              font-weight: 600;
                }

                button:hover {
                              transform: translateY(-2px);
                              box-shadow: 0 10px 20px rgba(245, 87, 108, 0.3);
                }

                .table-container {
                              overflow-x: auto;
                              margin-top: 30px;
                }

                table {
                              width: 100%;
                              border-collapse: collapse;
                }

                thead {
                              background-color: #f5f5f5;
                }

                th {
                              padding: 15px;
                              text-align: left;
                              font-weight: 600;
                              color: #333;
                              border-bottom: 3px solid #f093fb;
                }

                td {
                              padding: 15px;
                              border-bottom: 1px solid #e0e0e0;
                }

                tr:hover {
                              background-color: #f9f9f9;
                }

                .status-low {
                              background-color: #ffebee;
                              padding: 5px 10px;
                              border-radius: 5px;
                              color: #c62828;
                              font-weight: 600;
                }

                .status-medium {
                              background-color: #fff3e0;
                              padding: 5px 10px;
                              border-radius: 5px;
                              color: #e65100;
                              font-weight: 600;
                }

                .status-high {
                              background-color: #e8f5e9;
                              padding: 5px 10px;
                              border-radius: 5px;
                              color: #2e7d32;
                              font-weight: 600;
                }

                .stats {
                              display: grid;
                              grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                              gap: 20px;
                              margin-bottom: 40px;
                }

                .stat-card {
                              background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                              color: white;
                              padding: 20px;
                              border-radius: 10px;
                              text-align: center;
                }

                .stat-card h3 {
                              font-size: 2em;
                              margin-bottom: 10px;
                }

                .stat-card p {
                              opacity: 0.9;
                }

                .back-button {
                              display: inline-block;
                              margin-bottom: 20px;
                              background: #667eea;
                              padding: 10px 20px;
                              text-decoration: none;
                              color: white;
                              border-radius: 5px;
                              transition: all 0.3s ease;
                }

                .back-button:hover {
                              background: #764ba2;
                              transform: translateY(-2px);
                }

                .loading {
                              text-align: center;
                              padding: 40px;
                              font-size: 1.2em;
                              color: #666;
                }

                .sync-status {
                              position: fixed;
                              top: 20px;
                              right: 20px;
                              background: white;
                              padding: 10px 20px;
                              border-radius: 25px;
                              box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
                              display: flex;
                              align-items: center;
                              gap: 10px;
                              z-index: 1000;
                              font-size: 0.9em;
                }

                .sync-indicator {
                              width: 10px;
                              height: 10px;
                              border-radius: 50%;
                              background: #4caf50;
                              animation: pulse 2s infinite;
                }

                .sync-indicator.error {
                              background: #f44336;
                              animation: none;
                }

                .sync-indicator.syncing {
                              background: #ff9800;
                              animation: pulse 0.5s infinite;
                }

                @keyframes pulse {
                              0%, 100% { opacity: 1; }
                              50% { opacity: 0.5; }
                }

                @media (max-width: 768px) {
                              header h1 {
                                                font-size: 1.8em;
                              }

                              .content {
                                                padding: 20px;
                              }

                              .controls {
                                                grid-template-columns: 1fr;
                              }

                              table {
                                                font-size: 0.9em;
                              }

                              th, td {
                                                padding: 10px;
                              }
                }
            </style>
  </head>
  <body>
        <!-- Sync Status Indicator -->
        <div class="sync-status">
              <div class="sync-indicator" id="syncIndicator"></div>
              <span id="syncText">Connecting...</span>
        </div>

        <div class="container">
                  <header>
                                <a href="index.html" class="back-button">‚Üê Back to Home</a>a>
                                <h1>üì¶ Inventory Management</h1>
                              <p>Real-time inventory tracking and management</p>
                  </header>
        
                <div class="content">
                            <div class="stats">
                                            <div class="stat-card">
                                                                <h3 id="totalItems">0</h3>
                                                                <p>Total Items</p>
                                            </div>div>
                                            <div class="stat-card">
                                                                <h3 id="totalValue">$0</h3>
                                                                <p>Total Value</p>
                                            </div>div>
                                            <div class="stat-card">
                                                                <h3 id="lowStock">0</h3>
                                                                <p>Low Stock Items</p>
                                            </div>div>
                            </div>div>
                
                            <div class="controls">
                                            <input type="text" id="searchInput" placeholder="Search items...">
                                            <input type="text" id="itemName" placeholder="Item Name">
                                            <input type="text" id="itemSKU" placeholder="SKU">
                                            <input type="number" id="itemQuantity" placeholder="Quantity" min="0">
                                            <input type="number" id="itemCost" placeholder="Unit Cost" min="0" step="0.01">
                                            <input type="text" id="itemLocation" placeholder="Location">
                                            <button onclick="addItem()">Add Item</button>button>
                            </div>div>
                
                            <div class="table-container">
                                            <table>
                                                                  <thead>
                                                                                            <tr>
                                                                                                                          <th>Item Name</th>
                                                                                              <th>SKU</th>
                                                                                              <th>Quantity</th>
                                                                                              <th>Unit Cost</th>
                                                                                              <th>Total Value</th>
                                                                                              <th>Location</th>
                                                                                              <th>Status</th>
                                                                                              <th>Actions</th>
                                                                                            </tr>
                                                                  </thead>
                                                                <tbody id="inventoryTable">
                                                                    <tr class="loading">
                                                                        <td colspan="8">Loading inventory data...</td>td>
                                                                    </tr>
                                                                </tbody>tbody>
                                            </table>
                            </div>div>
                </div>div>
        </div>div>

      <script>
        // Inventory data and configuration
        let inventory = [];
        const API_URL = '/api.php';
        const REFRESH_INTERVAL = 5000; // Refresh every 5 seconds
        const STORAGE_KEY = 'tech_tank_inventory';
        let refreshTimer = null;
        let lastSyncTime = null;

        // Update sync status indicator
        function updateSyncStatus(status, message) {
              const indicator = document.getElementById('syncIndicator');
              const text = document.getElementById('syncText');

              indicator.className = 'sync-indicator';

              switch(status) {
                    case 'syncing':
                          indicator.classList.add('syncing');
                          text.textContent = message || 'Syncing...';
                          break;
                    case 'success':
                          text.textContent = message || 'Synced';
                          lastSyncTime = new Date();
                          break;
                    case 'error':
                          indicator.classList.add('error');
                          text.textContent = message || 'Sync Error';
                          break;
                    default:
                          text.textContent = message || 'Connected';
              }
        }

        // Save to localStorage
        function saveToLocalStorage() {
              try {
                    localStorage.setItem(STORAGE_KEY, JSON.stringify({
                          data: inventory,
                          timestamp: new Date().toISOString()
                    }));
              } catch (error) {
                    console.error('Error saving to localStorage:', error);
              }
        }

        // Load from localStorage
        function loadFromLocalStorage() {
              try {
                    const stored = localStorage.getItem(STORAGE_KEY);
                    if (stored) {
                          const parsed = JSON.parse(stored);
                          inventory = parsed.data || [];
                          displayInventory();
                          updateSyncStatus('success', 'Loaded from cache');
                          return true;
                    }
              } catch (error) {
                    console.error('Error loading from localStorage:', error);
              }
              return false;
        }

        // Start auto-refresh
        function startAutoRefresh() {
              if (refreshTimer) {
                    clearInterval(refreshTimer);
              }
              refreshTimer = setInterval(() => {
                    loadInventory(true); // Silent refresh
              }, REFRESH_INTERVAL);
        }

        // Stop auto-refresh
        function stopAutoRefresh() {
              if (refreshTimer) {
                    clearInterval(refreshTimer);
                    refreshTimer = null;
              }
        }

        // Load inventory on page load
        document.addEventListener('DOMContentLoaded', function() {
              // Try loading from localStorage first for instant display
              const hasCache = loadFromLocalStorage();

              // Then load fresh data from API
              loadInventory();

              // Start auto-refresh for cross-browser sync
              startAutoRefresh();
        });

        // Stop auto-refresh when page is hidden (save battery/bandwidth)
        document.addEventListener('visibilitychange', function() {
              if (document.hidden) {
                    stopAutoRefresh();
              } else {
                    loadInventory();
                    startAutoRefresh();
              }
        });

        // Load inventory from backend
        async function loadInventory(silent = false) {
              try {
                        if (!silent) {
                              updateSyncStatus('syncing', 'Syncing...');
                        }

                        const response = await fetch(`${API_URL}?action=read`, {
                              cache: 'no-cache', // Always get fresh data
                              headers: {
                                    'Cache-Control': 'no-cache'
                              }
                        });

                        if (!response.ok) {
                              throw new Error(`HTTP error! status: ${response.status}`);
                        }

                        const result = await response.json();

                        if (result.success) {
                                      inventory = result.data;
                                      saveToLocalStorage(); // Save to cache
                                      displayInventory();
                                      updateSyncStatus('success', `Synced (${inventory.length} items)`);
                        } else {
                                      console.error('Error loading inventory:', result.error);
                                      updateSyncStatus('error', 'API Error');
                                      if (!silent) {
                                            alert('Error loading inventory: ' + (result.error || 'Unknown error'));
                                      }
                        }
              } catch (error) {
                        console.error('Network error:', error);
                        updateSyncStatus('error', 'Network Error');

                        // If we have cached data, continue using it
                        if (inventory.length > 0) {
                              if (!silent) {
                                    alert('Network error. Showing cached data.');
                              }
                        } else if (!silent) {
                              alert('Network error and no cached data available.');
                        }
              }
        }

        // Display inventory in table
        function displayInventory(data = inventory) {
              const table = document.getElementById('inventoryTable');

              if (data.length === 0) {
                        table.innerHTML = '<tr><td colspan="8" style="text-align: center; padding: 20px;">No items found</td></tr>';
                        updateStats();
                        return;
              }

              table.innerHTML = data.map(item => `
                           <tr>
                                       <td>${item.name}</td>
                                                   <td>${item.sku}</td>
                                                               <td>${item.quantity}</td>
                                                                           <td>$${parseFloat(item.cost).toFixed(2)}</td>
                                                                                       <td>$${(item.quantity * item.cost).toFixed(2)}</td>
                                                                                                   <td>${item.location}</td>
                                                                                                               <td>
                                                                                                                               <span class="status-${getStatus(item.quantity)}">
                                                                                                                                                   ${item.quantity > 100 ? 'Good Stock' : item.quantity > 20 ? 'Medium' : 'Low Stock'}
                                                                                                                                                                   </span>
                                                                                                                                                                               </td>
                                                                                                                                                                                           <td>
                                                                                                                                                                                                           <button onclick="deleteItem('${item.id}')" style="background: #dc3545; padding: 5px 10px; font-size: 0.9em;">Delete</button>
                                                                                                                                                                                                                       </td>
                                                                                                                                                                                                                               </tr>
                                                                                                                                                                                                                                   `).join('');

              updateStats();
        }

        // Get stock status
        function getStatus(quantity) {
              if (quantity > 100) return 'high';
              if (quantity > 20) return 'medium';
              return 'low';
        }

        // Update stats
        function updateStats() {
              const totalItems = inventory.reduce((sum, item) => sum + item.quantity, 0);
              const totalValue = inventory.reduce((sum, item) => sum + (item.quantity * item.cost), 0);
              const lowStockCount = inventory.filter(item => item.quantity <= 20).length;

              document.getElementById('totalItems').textContent = totalItems;
              document.getElementById('totalValue').textContent = '$' + totalValue.toFixed(2);
              document.getElementById('lowStock').textContent = lowStockCount;
        }

        // Add item to backend
        async function addItem() {
              const name = document.getElementById('itemName').value;
              const sku = document.getElementById('itemSKU').value;
              const quantity = parseInt(document.getElementById('itemQuantity').value) || 0;
              const cost = parseFloat(document.getElementById('itemCost').value) || 0;
              const location = document.getElementById('itemLocation').value;

              if (!name || !sku) {
                        alert('Please enter item name and SKU');
                        return;
              }

              try {
                        updateSyncStatus('syncing', 'Adding item...');

                        const response = await fetch(`${API_URL}?action=create`, {
                                      method: 'POST',
                                      headers: { 'Content-Type': 'application/json' },
                                      body: JSON.stringify({ name, sku, quantity, cost, location })
                        });

                        const result = await response.json();

                        if (result.success) {
                                      clearInputs();
                                      await loadInventory(); // Refresh from backend
                                      alert('Item created successfully!');
                        } else {
                                      updateSyncStatus('error', 'Add failed');
                                      alert('Error creating item: ' + (result.error || 'Unknown error'));
                        }
              } catch (error) {
                        console.error('Error:', error);
                        updateSyncStatus('error', 'Network error');
                        alert('Error creating item');
              }
        }

        // Delete item from backend
        async function deleteItem(id) {
              if (!confirm('Are you sure you want to delete this item?')) return;

              try {
                        updateSyncStatus('syncing', 'Deleting item...');

                        const response = await fetch(`${API_URL}?action=delete`, {
                                      method: 'POST',
                                      headers: { 'Content-Type': 'application/json' },
                                      body: JSON.stringify({ id })
                        });

                        const result = await response.json();

                        if (result.success) {
                                      await loadInventory(); // Refresh from backend
                                      alert('Item deleted successfully!');
                        } else {
                                      updateSyncStatus('error', 'Delete failed');
                                      alert('Error deleting item: ' + (result.error || 'Unknown error'));
                        }
              } catch (error) {
                        console.error('Error:', error);
                        updateSyncStatus('error', 'Network error');
                        alert('Error deleting item');
              }
        }

        // Clear input fields
        function clearInputs() {
              document.getElementById('itemName').value = '';
              document.getElementById('itemSKU').value = '';
              document.getElementById('itemQuantity').value = '';
              document.getElementById('itemCost').value = '';
              document.getElementById('itemLocation').value = '';
        }

        // Search functionality
        document.getElementById('searchInput').addEventListener('keyup', function() {
              const searchTerm = this.value.toLowerCase();
              const filtered = inventory.filter(item =>
                        item.name.toLowerCase().includes(searchTerm) ||
                        item.sku.toLowerCase().includes(searchTerm)
                                                    );
              displayInventory(filtered);
        });
      </script>
  </body>body>
</html>html>
